---
import BaseLayout from '../../layouts/BaseLayout.astro';
import topicsData from '../../data/topics.json';

// Ensure base URL ends with /
const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : import.meta.env.BASE_URL + '/';

const { topics, topicList } = topicsData;
---

<BaseLayout title="Topics">
  <!-- Back navigation -->
  <a href={base} class="inline-flex items-center gap-2 text-sm text-base-content/60 hover:text-primary mb-4 group">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform group-hover:-translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    Back to Meetings
  </a>

  <header class="mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-base-content mb-2">
      Topics
    </h1>
    <p class="text-base-content/70">
      Browse meetings by topic. These keywords are automatically extracted from meeting discussions
      and represent issues that were flagged for attention.
    </p>
  </header>

  <!-- Topics grid -->
  <div class="grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
    {topicList.map((topicKey: string) => {
      const topic = topics[topicKey];
      return (
        <a
          href={`${base}topics/${encodeURIComponent(topicKey)}`}
          class="card bg-base-200 hover:bg-base-300 transition-colors border border-base-300 hover:border-primary/50"
        >
          <div class="card-body p-4">
            <h3 class="card-title text-base font-medium text-base-content capitalize">
              {topicKey.replace(/_/g, ' ')}
            </h3>
            <div class="flex items-center gap-2 mt-2">
              <span class="text-2xl font-bold text-primary">{topic.meetingCount}</span>
              <span class="text-sm text-base-content/60">
                meeting{topic.meetingCount !== 1 ? 's' : ''}
              </span>
            </div>
          </div>
        </a>
      );
    })}
  </div>

  {topicList.length === 0 && (
    <div class="text-center py-12">
      <p class="text-base-content/60">No topics found.</p>
    </div>
  )}
</BaseLayout>
